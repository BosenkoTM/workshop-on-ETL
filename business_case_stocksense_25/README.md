
# Бизнес-кейс «StockSense»

Самостоятельная работа

6.1.1. Развернуть ВМ [ubuntu_mgpu.ova](https://disk.yandex.ru/d/Psofa9xtbgUEOw) в [VirtualBox](https://disk.yandex.ru/d/3fD00plnL_a4Cw).

6.1.2. Клонировать на ПК задание **Бизнес-кейс «StockSense»** в домашний каталог ВМ. 

`git clone https://github.com/BosenkoTM/workshop-on-ETL.git`

6.1.3. Запустить контейнер с **Бизнес-кейсом «StockSense»**, изучить  основные элементы `DAG` в `Apache Airflow`. 
   - Создать `DAG` согласно алгоритму, который предоставит преподаватель.
   - Изучить логи, выполненного DAG. Скачать логи из контейнера в основную ОС.

Пример `docker-compose.yml` создает базу данных в Postgres:

- Host: `localhost`
- Port: `5433`
- Username: `airflow`
- Password: `airflow`
- Database: `airflow`

Эта база данных инициализируется таблицей `pageview_counts`.

**6.1.4.** Агрегированные данные бизнес-процесса, полученные в результате работы `DAG` в `Apache Airflow`, выгрузить в `Postgr SQL`. 

6.1.5. Спроектировать верхнеуровневую архитектуру аналитического решения **Бизнес-кейса «StockSense»** в `draw.io`. Необходимо использовать:
   - `Source Layer` - слой источников данных.
   - `Storage Layer` - слой хранения данных.
   - `Business Layer` - слой для доступа к данным пользователей.

6.1.6. Спроектировать архитектуру `DAG` **Бизнес-кейса «StockSense»** в `draw.io`. Необходимо использовать:
   - `Source Layer` - слой источников данных.
   - `Storage Layer` - слой хранения данных.
   - `Business Layer` - слой для доступа к данным пользователей.

6.1.7. Построить диаграмму Ганта работы `DAG` в `Apache Airflow`.

6.1.8. Результаты исследований представить в виде файла `ФИО-06.pdf`, в котором отражены следующие результаты:
- постановка задачи;
- исходный код всех DAGs, которые требовались для решения задачи, а также представить граф `DAG` в `Apache Airflow`;
- верхнеуровневая архитектура задания **Бизнес-кейса «StockSense»**, выполненная в `draw.io`;
- архитектура `DAG` **Бизнес-кейса «StockSense»** , выполненная в `draw.io`;
- диаграмма Ганта `DAG` в `Apache Airflow`;
- ERD-схема базы данных Postgre SQL;
- SQL-запросы, позволяющие проверить наличие выгруженных агрегированных данных бизнес-задачи. 

После проверки преподавателем работоспособности `DAG`, выгрузить отчет на портал [moodle]().


## Использование

Чтобы начать работу с примерами кода, запустите `Airflow` с помощью `Docker Compose`, выполнив команду:

Для версии `v1`:

```bash
docker-compose up -d
```
Для версии `v2`:

```bash
docker compose up -d
```

Веб-сервер инициализирует несколько задач, поэтому подождите несколько секунд, после чего сможете получить доступ к веб-серверу Airflow по адресу http://localhost:8080.

Чтобы остановить выполнение примеров, выполните следующую команду:

Для версии `v1`:

```bash
docker-compose down -v
```
Для версии `v2`:

```bash
docker compose down -v
```

## Индивидуальные задания

| Номер | Задание | Описание |
|-------|---------|----------|
| **1** | Получить данные за последний час для сайта Facebook | Скачайте данные за последний час по странице Facebook, извлеките и сохраните их в базе данных. |
| **2** | Получить данные за день для сайта Google | Скачайте данные за день для страницы Google и сохраните в базе данных. |
| **3** | Получить данные за месяц для сайта Microsoft | Скачайте данные за месяц для страницы Microsoft и сохраните их в базе данных. |
| **4** | SQL запрос для получения данных о максимальных просмотрах по часу | Используйте SQL-запрос для получения данных о максимальном числе просмотров по часу для всех страниц. |
| **5** | Визуализация данных по просмотрам страниц | Постройте график для отображения средних значений просмотров по часам для топ-5 страниц. |
| **6** | Получить данные за последний день для сайта Amazon | Скачайте данные за последний день для страницы Amazon, извлеките и сохраните их в базе данных. |
| **7** | Получить данные за месяц для сайта Apple | Скачайте данные за месяц для страницы Apple и сохраните в базе данных. |
| **8** | Получить данные за день для сайта Facebook | Скачайте данные за день для страницы Facebook и сохраните их в базе данных. |
| **9** | Получить данные за неделю для сайта Google | Скачайте данные за неделю для страницы Google и сохраните их в базе данных. |
| **10** | SQL запрос для подсчета среднего числа просмотров по часам | Напишите SQL-запрос для подсчета среднего числа просмотров по часам для каждого сайта. |
| **11** | Визуализация данных по просмотрам страниц по часам | Постройте график для отображения числа просмотров по каждому часу для сайта Microsoft. |
| **12** | Получить данные за месяц для сайта Facebook | Скачайте данные за месяц для страницы Facebook, извлеките и сохраните их в базе данных. |
| **13** | Получить данные за день для сайта Apple | Скачайте данные за день для страницы Apple и сохраните их в базе данных. |
| **14** | Получить данные за неделю для сайта Amazon | Скачайте данные за неделю для страницы Amazon и сохраните их в базе данных. |
| **15** | SQL запрос для получения данных по максимуму просмотров для каждого сайта | Напишите SQL-запрос, который будет выводить максимальное число просмотров для каждого сайта по часам. |
| **16** | Визуализация топ-5 сайтов по просмотрам | Постройте график, который отображает топ-5 сайтов по числу просмотров за последний месяц. |
| **17** | Получить данные за месяц для сайта Microsoft | Скачайте данные за месяц для страницы Microsoft и сохраните их в базе данных. |
| **18** | Получить данные за день для сайта Google | Скачайте данные за день для страницы Google и сохраните их в базе данных. |
| **19** | Получить данные за неделю для сайта Facebook | Скачайте данные за неделю для страницы Facebook и сохраните их в базе данных. |
| **20** | SQL запрос для получения среднего числа просмотров по страницам | Напишите SQL-запрос для получения среднего числа просмотров по страницам для разных часов. |
| **21** | Визуализация сравнения числа просмотров по дням | Постройте график, сравнивающий количество просмотров по дням для страниц Apple и Amazon. |
| **22** | Получить данные за последний час для сайта Apple | Скачайте данные за последний час для страницы Apple и сохраните их в базе данных. |
| **23** | Получить данные за неделю для сайта Microsoft | Скачайте данные за неделю для страницы Microsoft и сохраните их в базе данных. |
| **24** | Получить данные за месяц для сайта Google | Скачайте данные за месяц для страницы Google и сохраните их в базе данных. |
| **25** | SQL запрос для вычисления медианы просмотров по часам | Напишите SQL-запрос для вычисления медианы числа просмотров по часам для каждого сайта. |
| **26** | Визуализация сравнения числа просмотров для сайтов | Постройте график, сравнивающий количество просмотров для сайтов Google, Apple и Facebook. |
| **27** | Получить данные за день для сайта Microsoft | Скачайте данные за день для страницы Microsoft и сохраните их в базе данных. |
| **28** | Получить данные за последний час для сайта Facebook | Скачайте данные за последний час для страницы Facebook и сохраните их в базе данных. |
| **29** | Получить данные за месяц для сайта Amazon | Скачайте данные за месяц для страницы Amazon и сохраните их в базе данных. |
| **30** | SQL запрос для получения данных по всем сайтам за последний час | Напишите SQL-запрос, который будет выводить данные по всем сайтам за последний час. |
